{% extends 'layout.html' %}
{% block title %}
    ä»»åŠ¡2
{% endblock %}
{% block script %}
    <script>
        var pid = 0
        $(document).ready(function () {
            $("#DA").click(function () {
                var DA = document.getElementById("DA")
                DA.setAttribute("disabled", "disabled")
                console.log(DA)
                var seed = Math.random()
                console.log(seed)
                var sel = document.getElementById("bit");//selectå…ƒç´ çš„id
                var index = sel.selectedIndex;//è·å–è¢«é€‰ä¸­çš„optionçš„ç´¢å¼•
                var bit = sel.options[index].text;//è·å–ç›¸åº”çš„optionçš„å†…å®¹
                sel = document.getElementById("choose");
                var index = sel.selectedIndex;
                var choose = sel.options[index].value
                var key = document.getElementById("key").value
                var text = document.getElementById("text").value
                if (key.match("^[0-9|a-z|A-Z]{8}$") && text.match("^[0-9|a-z|A-Z]{8}$")) {
                    $("#bar").attr("class", "progress-bar progress-bar-striped active")
                    $("#bar").width(0)
                    var sitv = setInterval(function () {
                        $.ajax({
                            url: "{{ url_for("task_two_check")}}",
                            data: {seed: seed},
                            type: 'POST',
                            async: true,
                            success: function (percent) {
                                var bar = document.getElementById("bar")
                                bar.style = "width: " + percent + "%"
                                $("#bar").width(percent + '%');
                                console.log(percent)
                            }
                        })

                    }, 1000)
                    $.ajax({
                        url: "{{ url_for('task_two') }}",
                        type: 'POST',
                        async: true,
                        data: {
                            key: key,
                            text: text,
                            bit: bit,
                            choose: choose,
                            seed: seed
                        },
                        success: function (data, status) {
                            clearInterval(sitv)
                            $("#bar").width(100 + "%")
                            $('#bar').attr("class", "progress progress-bar-success");
                            var img = document.createElement("img")
                            img.src = data
                            img.className = "img-thumbnail"
                            img.id = pid
                            document.getElementById("pic").insertBefore(img, document.getElementById(pid - 1))
                            pid++
                            DA.removeAttribute("disabled")
                        }
                    })

                    return false
                    //å¦‚æœjsæäº¤äº†å°±ä¸è¦htmlçš„formè¡¨å•åœ¨æäº¤ä¸€æ¬¡äº†
                }
                DA.removeAttribute("disabled")
                return true
                //å¦‚æœjsæ²¡æäº¤æˆåŠŸå°±è®©formè¡¨å•æäº¤ï¼Œä½†äº‹å®ä¸Šï¼Œè¿‡ä¸äº†inputæ ‡ç­¾çš„åŒ¹é…ï¼Œæ˜¯ä¸ºäº†è®©inputæ ‡ç­¾æ¥æ‹¦æˆªéæ³•è¾“å…¥
            })
        });
    </script>
{% endblock %}
{% block body %}
    <div class="jumbotron">
        <div class="container">
            <h1>DESçš„ä»»åŠ¡</h1>
            <p>2. ç»Ÿè®¡DESç®—æ³•åœ¨å¯†é’¥å›ºå®šæƒ…å†µï¼Œè¾“å…¥æ˜æ–‡æ”¹å˜1ä½ã€2ä½ï¼Œã€‚ã€‚ã€‚64ä½æ—¶ã€‚è¾“å‡ºå¯†æ–‡ä½æ•°æ”¹å˜æƒ…å†µã€‚</p>
            <p>3. ç»Ÿè®¡DESç®—æ³•åœ¨æ˜æ–‡å›ºå®šæƒ…å†µï¼Œå¯†é’¥ğŸ”‘æ”¹å˜1ä½ã€2ä½ï¼Œã€‚ã€‚ã€‚64ä½æ—¶ã€‚è¾“å‡ºå¯†æ–‡ä½æ•°æ”¹å˜æƒ…å†µã€‚</p>
            <form class="form-inline">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon">
                            è¾“å…¥ä½ å–œæ¬¢çš„DESå¯†é’¥
                        </div>
                        <input type="text" class="form-control" id="key" placeholder="è¾“å…¥8ä½è‹±æ–‡æˆ–æ•°å­—å­—ç¬¦"
                               pattern="^[0-9|a-z|A-Z]{8}$"
                               title="è¯·è¾“å…¥8ä½è‹±æ–‡æˆ–æ•°å­—å­—ç¬¦">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon">
                            è¾“å…¥åŠ å¯†çš„è¦æ˜æ–‡
                        </div>
                        <input type="text" class="form-control" id="text" placeholder="è¾“å…¥8ä½è‹±æ–‡æˆ–æ•°å­—å­—ç¬¦"
                               pattern="^[0-9|a-z|A-Z]{8}$"
                               title="è¯·è¾“å…¥8ä½è‹±æ–‡æˆ–æ•°å­—å­—ç¬¦">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon">
                            è¾“å…¥è¦æµ‹è¯•çš„æ”¹å˜ä½æ•°
                        </div>
                        <select class="form-control" id="bit">
                            {% for i in range(0,65) %}
                                <option>{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="container">
                        <div class="input-group">
                            <div class="input-group-addon">
                                è¯·é€‰æ‹©æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹
                            </div>
                            <select class="form-control" id="choose">
                                <option value="1">ä»»åŠ¡2</option>
                                <option value="2">ä»»åŠ¡3</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" id="DA" onclick="false">è¾“å‡ºå¯†æ–‡ä½æ•°æ”¹å˜æƒ…å†µã€‚</button>
                    </div>
                </div>
            </form>

        </div>
    </div>
    <div class="container" id="pic">
        <div class="row">
            <h3>è¿è¡Œè¿›åº¦ï¼š</h3>
            <div class="progress">
                <div class="progress-bar progress-bar-striped active" role="progressbar"
                     aria-valuemin="0" aria-valuemax="100" style="width: 10%" id="bar">
                    <span class="sr-only">45% Complete</span>
                </div>
            </div>
        </div>
        <h3>æ•°æ®ç»Ÿè®¡ç»“æœ:åœ¨éšæœºå–æ•°æ®1000ç»„çš„ç»Ÿè®¡æƒ…å†µä¸‹</h3>

    </div>
{% endblock %}